{
  "consumer": {
    "name": "kotsadm-web"
  },
  "provider": {
    "name": "kotsadm-api"
  },
  "interactions": [
    {
      "description": "A query to get a kots app",
      "request": {
        "method": "POST",
        "path": "/graphql",
        "headers": {
          "Authorization": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1NDYzMDQ0MDAwMDAsInRva2VuIjoibm90LWNoZWNrZWQiLCJzZXNzaW9uSWQiOiJnZXQta290cy1hcHAtdXNlci1zZXNzaW9uIn0.2zd4bH-mpHwEOwkp4JW1l_tOR5J36IfcyxfAvLxe8WE",
          "Content-Type": "application/json"
        },
        "body": {
          "operationName": "getKotsApp",
          "query": "\n  query getKotsApp($slug: String!) {\n    getKotsApp(slug: $slug) {\n      id\n      name\n      iconUri\n      createdAt\n      updatedAt\n      slug\n      upstreamUri\n      currentSequence\n      hasPreflight\n      isAirgap\n      isConfigurable\n      isGitOpsSupported\n      allowRollback\n      isSnapshotSupported\n      currentVersion {\n        title\n        status\n        createdOn\n        sequence\n        releaseNotes\n        deployedAt\n      }\n      lastUpdateCheckAt\n      bundleCommand\n      downstreams {\n        name\n        links {\n          title\n          uri\n        }\n        currentVersion {\n          title\n          status\n          createdOn\n          sequence\n          deployedAt\n          source\n          releaseNotes\n          parentSequence\n        }\n        pendingVersions {\n          title\n          status\n          createdOn\n          sequence\n          deployedAt\n          parentSequence\n        }\n        pastVersions {\n          title\n          status\n          createdOn\n          sequence\n          deployedAt\n          parentSequence\n        }\n        gitops {\n          enabled\n          provider\n          uri\n          hostname\n          path\n          branch\n          format\n          action\n          deployKey\n          isConnected\n        }\n        cluster {\n          id\n          title\n          slug\n          createdOn\n          lastUpdated\n          currentVersion {\n            title\n            status\n            createdOn\n            sequence\n            deployedAt\n          }\n          shipOpsRef {\n            token\n          }\n          totalApplicationCount\n        }\n      }\n    }\n  }\n",
          "variables": {
            "slug": "kots-app-slug"
          }
        },
        "matchingRules": {
          "$.body.query": {
            "match": "regex",
            "regex": "\\s*query\\s*getKotsApp\\(\\$slug:\\s*String!\\)\\s*\\{\\s*getKotsApp\\(slug:\\s*\\$slug\\)\\s*\\{\\s*id\\s*name\\s*iconUri\\s*createdAt\\s*updatedAt\\s*slug\\s*upstreamUri\\s*currentSequence\\s*hasPreflight\\s*isAirgap\\s*isConfigurable\\s*isGitOpsSupported\\s*allowRollback\\s*isSnapshotSupported\\s*currentVersion\\s*\\{\\s*title\\s*status\\s*createdOn\\s*sequence\\s*releaseNotes\\s*deployedAt\\s*\\}\\s*lastUpdateCheckAt\\s*bundleCommand\\s*downstreams\\s*\\{\\s*name\\s*links\\s*\\{\\s*title\\s*uri\\s*\\}\\s*currentVersion\\s*\\{\\s*title\\s*status\\s*createdOn\\s*sequence\\s*deployedAt\\s*source\\s*releaseNotes\\s*parentSequence\\s*\\}\\s*pendingVersions\\s*\\{\\s*title\\s*status\\s*createdOn\\s*sequence\\s*deployedAt\\s*parentSequence\\s*\\}\\s*pastVersions\\s*\\{\\s*title\\s*status\\s*createdOn\\s*sequence\\s*deployedAt\\s*parentSequence\\s*\\}\\s*gitops\\s*\\{\\s*enabled\\s*provider\\s*uri\\s*hostname\\s*path\\s*branch\\s*format\\s*action\\s*deployKey\\s*isConnected\\s*\\}\\s*cluster\\s*\\{\\s*id\\s*title\\s*slug\\s*createdOn\\s*lastUpdated\\s*currentVersion\\s*\\{\\s*title\\s*status\\s*createdOn\\s*sequence\\s*deployedAt\\s*\\}\\s*shipOpsRef\\s*\\{\\s*token\\s*\\}\\s*totalApplicationCount\\s*\\}\\s*\\}\\s*\\}\\s*\\}\\s*"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "data": {
            "getKotsApp": {
              "id": "get-kots-app-id",
              "name": "kots-app-name",
              "createdAt": "date",
              "updatedAt": "date",
              "slug": "kots-app-slug",
              "currentSequence": 0,
              "hasPreflight": false,
              "isAirgap": false,
              "currentVersion": null,
              "lastUpdateCheckAt": "date",
              "bundleCommand": "\n      curl https://krew.sh/support-bundle | bash\n      kubectl support-bundle API_ADDRESS/api/v1/troubleshoot/kots-app-slug\n    ",
              "downstreams": [

              ]
            }
          }
        },
        "matchingRules": {
          "$.body.data.getKotsApp.createdAt": {
            "match": "type"
          },
          "$.body.data.getKotsApp.updatedAt": {
            "match": "type"
          },
          "$.body.data.getKotsApp.lastUpdateCheckAt": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a mutation to deploy a kots version",
      "request": {
        "method": "POST",
        "path": "/graphql",
        "headers": {
          "Authorization": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1NDYzMDQ0MDAwMDAsInRva2VuIjoibm90LWNoZWNrZWQiLCJzZXNzaW9uSWQiOiJkZXBsb3kta290cy12ZXJzaW9uLXVzZXItc2Vzc2lvbiJ9.pLpB0KiQvda0NeN79dNGIGjePpEEmcFmSJuDhq7rAl0",
          "Content-Type": "application/json"
        },
        "body": {
          "operationName": "deployKotsVersion",
          "query": "\n  mutation deployKotsVersion($upstreamSlug: String!, $sequence: Int!, $clusterSlug: String!) {\n    deployKotsVersion(upstreamSlug: $upstreamSlug, sequence: $sequence, clusterSlug: $clusterSlug)\n  }\n",
          "variables": {
            "upstreamSlug": "deploy-kots-version-app-slug",
            "sequence": 1,
            "clusterSlug": "deploy-kots-version-cluster-slug"
          }
        },
        "matchingRules": {
          "$.body.query": {
            "match": "regex",
            "regex": "\\s*mutation\\s*deployKotsVersion\\(\\$upstreamSlug:\\s*String!,\\s*\\$sequence:\\s*Int!,\\s*\\$clusterSlug:\\s*String!\\)\\s*\\{\\s*deployKotsVersion\\(upstreamSlug:\\s*\\$upstreamSlug,\\s*sequence:\\s*\\$sequence,\\s*clusterSlug:\\s*\\$clusterSlug\\)\\s*\\}\\s*"
          }
        }
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json"
        },
        "body": {
          "data": {
            "deployKotsVersion": true
          }
        }
      }
    }
  ],
  "metadata": {
    "pactSpecification": {
      "version": "2.0.0"
    }
  }
}
