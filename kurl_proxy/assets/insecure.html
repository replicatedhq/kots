<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="Replicated App Manager" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TLS Warning | Admin Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/assets/tls-custom.css" />
    {{if .AppIcon }}
    <link rel="icon" type="image/png" href="{{ .AppIcon }}" />
    {{end}}
    <script>
      //defaults to chrome example
      var firefoxText =
        'On the next screen, click "I Understand the Risks", then click "Add Exception". Finally, click "Confirm Security Exception" to proceed to the Admin Console.';
      var ieText =
        'On the next screen, click "Continue to this website" to proceed to the Admin Console.';
      var safariText =
        'On the next screen, click "Continue" when prompted to proceed to the Admin Console.';
      var chromeText =
        'On the next screen, click "Advanced", then click "Proceed" to continue to the Admin Console.';

      var browserPlainText = "Chrome";
      var browserBodyText = chromeText;
      if (typeof InstallTrigger !== "undefined") {
        browserPlainText = "Firefox";
        browserBodyText = chromeText;
      } else if (
        Object.prototype.toString
          .call(window.HTMLElement)
          .indexOf("Constructor") > 0
      ) {
        browserPlainText = "Safari";
        browserBodyText = safariText;
      } else if (
        /*@cc_on!@*/ false ||
        !!document.documentMode ||
        !!window.StyleMedia
      ) {
        //grouping Edge + IE 6 - 11 in this one
        browserPlainText = "Internet Explorer";
        browserBodyText = ieText;
      }

      var rawLink = window.location.href
        .substring(window.location.protocol.length)
        .replace(/\/$/, "");
      var httpsLink = "https:" + rawLink;
      var opensslLink = rawLink.substring(2).replace("/insecure", "");
      console.log(opensslLink, "hello");
      var tlsManagementLink = "/tls";
      console.log(tlsManagementLink, "link");
    </script>
  </head>
  <body>
    <div class="min-h-full w-full flex flex-1">
      <div class="max-w-[350px] bg-[#F9FBFC] px-6 pt-6">
        <div class="flex flex1">
          {{if .AppIcon }}<span
            class="appIcon flex"
            style="background-image: url('{{ .AppIcon }}')"
          ></span
          >{{end}}
          <p class="text-xl font-bold pb-4">{{ .AppTitle }} Admin Console</p>
        </div>
        <div class="pt-8 pl-8">
          <span class="text-lg font-semibold !color-gray-[#323232]">
            Let's get you started!
          </span>
        </div>
        <div
          class="p-8 shadow-[0_1px_0_#c4c8ca] font-medium flex items-center gap-2"
        >
          <img src="/assets/images/check.svg" alt="check" />
          <span> Secure the {{.AppTitle}} Admin Console </span>
        </div>
        <div
          class="p-8 shadow-[0_1px_0_#c4c8ca] font-medium flex items-center gap-2"
        >
          <img src="/assets/images/check.svg" alt="check" />
          <span> Configure the cluster (optional) </span>
        </div>
        <div
          class="p-8 shadow-[0_1px_0_#c4c8ca] font-medium flex items-center gap-2"
        >
          <img src="/assets/images/check.svg" alt="check" />
          <span> Configure {{.AppTitle}} </span>
        </div>
        <div
          class="p-8 shadow-[0_1px_0_#c4c8ca] font-medium flex items-center gap-2"
        >
          <img src="/assets/images/check.svg" alt="check" />
          <span> Validate the environment & Install {{.AppTitle}} </span>
        </div>
      </div>

      <div class="tlsContent--wrapper tw-mt-8">
        <div>
          <p class="tls-header">Bypass browser TLS warning</p>
          <p class="tls-header-sub">
            We use a self-signed SSL/TLS Certificate to secure the communication
            between your local machine and the Admin Console during setup.
            You'll see a warning about this in your browser, but you can be
            confident that this is secure.
          </p>
        </div>
        <div class="flex1 flex">
          <div class="flex-column flex1 left-block">
            <div>
              <p class="tls-section-header">
                <script>
                  document.write(browserPlainText);
                </script>
              </p>
              <p class="tls-section-sub">
                <script>
                  document.write(browserBodyText);
                </script>
              </p>
            </div>
            <div class="CodeSnippet">
              <div class="CodeSnippet-content">
                <p>Verifying the certificate's authenticity</p>
                <pre>
                  <code id="verify-snippet">
                  </code>
                </pre>
              </div>
            </div>
            <div class="CodeSnippet">
              <div class="CodeSnippet-content">
                <p>SHA Fingerprint</p>
                <pre>
                  <code>{{ .fingerprintSHA1 }}</code>
                </pre>
              </div>
            </div>
            <div class="button-wrapper flex alignItems--center">
              <button
                type="submit"
                class="btn primary"
                onclick="location.href=tlsManagementLink;"
              >
                Continue to Setup
              </button>
              <div class="flex-column justifyContent--center">
                <p class="text-muted">
                  <script>
                    document.write(
                      'or visit <a class="replicated-link" href="' +
                        tlsManagementLink +
                        '">' +
                        opensslLink +
                        tlsManagementLink +
                        "</a> to proceed",
                    );
                  </script>
                </p>
              </div>
            </div>
          </div>
          <div
            class="flex-column flex1 right-block alignItems--center justifyContent--center"
          >
            <script>
              document.write(
                '<img class="insecure-image" src="/assets/images/' +
                  browserPlainText.toLowerCase().replace(" ", "") +
                  '-insecure.png" />',
              );
            </script>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    document.getElementById("verify-snippet").innerHTML =
      "$ echo | openssl s_client -servername local -connect " +
      opensslLink +
      " 2>/dev/null | openssl x509 -noout -fingerprint";
  </script>
</html>
